<!DOCTYPE html><html lang="en" data-astro-cid-bvzihdzo> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/z.svg"><meta name="generator" content="Astro v4.8.2"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://vitalspace.github.io/aprende/genericos/"><!-- Primary Meta Tags --><title>Genericos</title><meta name="title" content="Genericos"><meta name="description" content="Genericos"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://vitalspace.github.io/aprende/genericos/"><meta property="og:title" content="Genericos"><meta property="og:description" content="Genericos"><meta property="og:image" content="https://vitalspace.github.io/blog-placeholder-1.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://vitalspace.github.io/aprende/genericos/"><meta property="twitter:title" content="Genericos"><meta property="twitter:description" content="Genericos"><meta property="twitter:image" content="https://vitalspace.github.io/blog-placeholder-1.jpg"><link rel="stylesheet" href="/themes/prism.css"><link rel="stylesheet" href="/astro/about.B0WHY4Jg.css">
<style>:root{--accent: #2337ff;--accent-dark: #000d8a;--black: 15, 18, 25;--gray: 96, 115, 159;--gray-light: 229, 233, 240;--gray-dark: 34, 41, 57;--gray-gradient: rgba(var(--gray-light), 50%), #000000;--box-shadow: 0 2px 6px rgba(var(--gray), 25%), 0 8px 24px rgba(var(--gray), 33%), 0 16px 32px rgba(var(--gray), 33%)}@font-face{font-family:Atkinson;src:url(/fonts/atkinson-regular.woff) format("woff");font-weight:400;font-style:normal;font-display:swap}@font-face{font-family:Atkinson;src:url(/fonts/atkinson-bold.woff) format("woff");font-weight:700;font-style:normal;font-display:swap}h1,h2,h3,h4,h5,h6{margin:0 0 .5rem;color:rgb(var(--black));line-height:1.2}h1{font-size:3.052em}h2{font-size:2.441em}h3{font-size:1.953em}h4{font-size:1.563em}h5{font-size:1.25em}strong,b{font-weight:700}a,a:hover{color:var(--accent)}p{margin-bottom:1em}.prose p{margin-bottom:2em}textarea{width:100%;font-size:16px}input{font-size:16px}table{width:100%}img{max-width:100%;height:auto;border-radius:8px}code{background-color:rgb(var(--gray-light));border-radius:2px}pre{padding:1.5em;border-radius:8px}pre>code{all:unset}blockquote{border-left:4px solid var(--accent);margin:0;font-size:1.333em}hr{border:none;border-top:1px solid rgb(var(--gray-light))}@media (max-width: 720px){body{font-size:18px}}.sr-only{border:0;padding:0;margin:0;position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px);clip-path:inset(50%);white-space:nowrap}
main[data-astro-cid-bvzihdzo]{width:calc(100% - 2em);max-width:100%;margin:0}.hero-image[data-astro-cid-bvzihdzo]{width:100%}.hero-image[data-astro-cid-bvzihdzo] img[data-astro-cid-bvzihdzo]{display:block;margin:0 auto;border-radius:12px;box-shadow:var(--box-shadow)}.prose[data-astro-cid-bvzihdzo]{width:720px;max-width:calc(100% - 2em);margin:auto;padding:1em;color:rgb(var(--gray-dark))}.title[data-astro-cid-bvzihdzo]{margin-bottom:1em;padding:1em 0;text-align:center;line-height:1}.title[data-astro-cid-bvzihdzo] h1[data-astro-cid-bvzihdzo]{margin:0 0 .5em}.date[data-astro-cid-bvzihdzo]{margin-bottom:.5em;color:rgb(var(--gray))}.last-updated-on[data-astro-cid-bvzihdzo]{font-style:italic}
</style></head> <body data-astro-cid-bvzihdzo> <header class="m-0 py-5 px-4  shadow-gray-500 bg-[#242526] border-b-[0.1px] border-gray-500"> <nav class="flex items-center justify-around"> <a class="flex items-center" href="/"> <img class="w-10 h-10 mr-1" src="/z.svg" alt=""> <span class="text-white">zig.lat</span> </a> <div class="internal-links flex items-center space-x-6"> <a href="/guia" class="inline-block text-base text-gray-400 hover:text-white"> Guía </a> <!-- <HeaderLink class="text-white" href="/aprende">Aprende</HeaderLink> --> <!-- <HeaderLink class="text-white" href="/about">About</HeaderLink> --> <div class="social-links flex items-center space-x-6"> <a class="w-10" href="https://discord.gg/jKCuJChF" target="_blank"> <img class="hover:rotate-12 transition-all" src="/discord.svg" alt=""> </a> <a class="w-8" href="https://github.com/ziglatino/zig-lat" target="_blank"> <img class="hover:rotate-12 transition-all" src="/github.svg" alt=""> </a> </div> </div> </nav> </header> <main data-astro-cid-bvzihdzo> <article data-astro-cid-bvzihdzo> <div class="hero-image" data-astro-cid-bvzihdzo> <img width="1020" height="510" src="/blog-placeholder-5.jpg" alt="" data-astro-cid-bvzihdzo> </div> <div class="prose" data-astro-cid-bvzihdzo> <div class="title" data-astro-cid-bvzihdzo> <div class="date" data-astro-cid-bvzihdzo> <time datetime="2022-07-02T05:00:00.000Z"> Jul 2, 2022 </time>  </div> <h1 data-astro-cid-bvzihdzo>Genericos</h1> <hr data-astro-cid-bvzihdzo> </div>  <p>En la parte anterior construimos una estructura de datos básica llamada <code>IntList</code>. El objetivo de esta estructura de datos era almacenar un número dinámico de valores. Aunque el algoritmo que usamos funcionaría para cualquier tipo de datos, nuestra implementación estaba ligada a valores de tipo <code>i64</code>. Ahora entran en juego los genéricos, cuyo objetivo es abstraer algoritmos y estructuras de datos de tipos específicos.</p>
<p>Muchos lenguajes implementan genéricos con una sintaxis especial y reglas específicas para genéricos. Con Zig, los genéricos son menos una característica específica y más una expresión de lo que el lenguaje es capaz de hacer. Específicamente, los genéricos aprovechan la potente metaprogramación en tiempo de compilación de Zig.</p>
<p>Comenzaremos mirando un ejemplo tonto, solo para orientarnos:</p>
<pre class="language-zig"><code class="language-zig"><span class="token keyword">const</span> std <span class="token operator">=</span> <span class="token builtin">@import</span><span class="token punctuation">(</span><span class="token string">"std"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token class-name"><span class="token operator">!</span><span class="token builtin-type keyword">void</span></span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> arr<span class="token punctuation">:</span> <span class="token function">IntArray</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
	arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
	std<span class="token punctuation">.</span>debug<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>"<span class="token punctuation">{</span>any<span class="token punctuation">}</span>
"<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">{</span>arr<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function">IntArray</span><span class="token punctuation">(</span><span class="token keyword">comptime</span> length<span class="token punctuation">:</span> <span class="token class-name"><span class="token builtin-type keyword">usize</span></span><span class="token punctuation">)</span> <span class="token class-name"><span class="token builtin-type keyword">type</span></span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token punctuation">[</span>length<span class="token punctuation">]</span><span class="token builtin-type keyword">i64</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<br/>
<p>Lo anterior imprime <code>{ 1, 10, 100 }</code>. La parte interesante es que tenemos una función que devuelve un <code>type</code> (de ahí que la función esté en PascalCase). Y no solo cualquier tipo, sino un tipo basado en un parámetro de función. Este código solo funcionó porque declaramos <code>length</code> como <code>comptime</code>. Es decir, requerimos que cualquiera que llame a <code>IntArray</code> pase un parámetro de longitud conocido en tiempo de compilación. Esto es necesario porque nuestra función devuelve un <code>type</code> y los <code>types</code> siempre deben ser conocidos en tiempo de compilación.</p>
<p>Una función puede devolver cualquier tipo, no solo primitivos y matrices. Por ejemplo, con un pequeño cambio, podemos hacer que devuelva una estructura:</p>
<pre class="language-zig"><code class="language-zig"><span class="token keyword">const</span> std <span class="token operator">=</span> <span class="token builtin">@import</span><span class="token punctuation">(</span><span class="token string">"std"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token class-name"><span class="token operator">!</span><span class="token builtin-type keyword">void</span></span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> arr<span class="token punctuation">:</span> <span class="token function">IntArray</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
	arr<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	arr<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	arr<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
	std<span class="token punctuation">.</span>debug<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>"<span class="token punctuation">{</span>any<span class="token punctuation">}</span>
"<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">{</span>arr<span class="token punctuation">.</span>items<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function">IntArray</span><span class="token punctuation">(</span><span class="token keyword">comptime</span> length<span class="token punctuation">:</span> <span class="token class-name"><span class="token builtin-type keyword">usize</span></span><span class="token punctuation">)</span> <span class="token class-name"><span class="token builtin-type keyword">type</span></span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
		items<span class="token punctuation">:</span> <span class="token class-name"><span class="token punctuation">[</span>length<span class="token punctuation">]</span><span class="token builtin-type keyword">i64</span></span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<br/>
<p>Puede parecer extraño, pero el tipo de <code>arr&#39;s</code> realmente es <code>IntArray(3)</code>. Es un tipo como cualquier otro tipo y <code>arr</code> es un valor como cualquier otro valor. Si llamáramos a <code>IntArray(7)</code>, ese sería un tipo diferente. Tal vez podamos hacer las cosas más ordenadas:</p>
<pre class="language-zig"><code class="language-zig"><span class="token keyword">const</span> std <span class="token operator">=</span> <span class="token builtin">@import</span><span class="token punctuation">(</span><span class="token string">"std"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token class-name"><span class="token operator">!</span><span class="token builtin-type keyword">void</span></span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token function">IntArray</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	arr<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	arr<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	arr<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
	std<span class="token punctuation">.</span>debug<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>"<span class="token punctuation">{</span>any<span class="token punctuation">}</span>
"<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">{</span>arr<span class="token punctuation">.</span>items<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function">IntArray</span><span class="token punctuation">(</span><span class="token keyword">comptime</span> length<span class="token punctuation">:</span> <span class="token class-name"><span class="token builtin-type keyword">usize</span></span><span class="token punctuation">)</span> <span class="token class-name"><span class="token builtin-type keyword">type</span></span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
		items<span class="token punctuation">:</span> <span class="token class-name"><span class="token punctuation">[</span>length<span class="token punctuation">]</span><span class="token builtin-type keyword">i64</span></span><span class="token punctuation">,</span>

		<span class="token keyword">fn</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token function">IntArray</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token punctuation">{</span>
				<span class="token punctuation">.</span>items <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>A simple vista, eso podría no parecer más ordenado. Pero además de ser anónimo y estar anidado en una función, nuestra estructura se parece a todas las demás estructuras que hemos visto hasta ahora. Tiene campos, tiene funciones. Ya sabes lo que dicen, si parece un pato… Bueno, esto parece, nada y grazna como una estructura normal, porque lo es.</p>
<p>Hemos tomado este camino para familiarizarnos con una función que devuelve un <code>type</code> y la sintaxis que la acompaña. Para obtener un genérico más típico, necesitamos hacer un último cambio: nuestra función debe tomar un <code>type</code>. En realidad, este es un cambio pequeño, pero <code>type</code> puede sentirse más abstracto que <code>usize</code>, así que lo hicimos lentamente. Vamos a dar un salto y modificar nuestro <code>IntList</code> anterior para que funcione con cualquier tipo. Comenzaremos con un esqueleto:</p>
<pre class="language-zig"><code class="language-zig"><span class="token keyword">fn</span> <span class="token function">List</span><span class="token punctuation">(</span><span class="token keyword">comptime</span> T<span class="token punctuation">:</span> <span class="token class-name"><span class="token builtin-type keyword">type</span></span><span class="token punctuation">)</span> <span class="token class-name"><span class="token builtin-type keyword">type</span></span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
		pos<span class="token punctuation">:</span> <span class="token class-name"><span class="token builtin-type keyword">usize</span></span><span class="token punctuation">,</span>
		items<span class="token punctuation">:</span> <span class="token class-name"><span class="token punctuation">[</span><span class="token punctuation">]</span>T</span><span class="token punctuation">,</span>
		allocator<span class="token punctuation">:</span> <span class="token class-name">Allocator</span><span class="token punctuation">,</span>

		<span class="token keyword">fn</span> <span class="token function">init</span><span class="token punctuation">(</span>allocator<span class="token punctuation">:</span> <span class="token class-name">Allocator</span><span class="token punctuation">)</span> <span class="token operator">!</span><span class="token function">List</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token punctuation">{</span>
				<span class="token punctuation">.</span>pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
				<span class="token punctuation">.</span>allocator <span class="token operator">=</span> allocator<span class="token punctuation">,</span>
				<span class="token punctuation">.</span>items <span class="token operator">=</span> <span class="token keyword">try</span> allocator<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span>T<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<br/>
<p>La <code>struct</code> anterior es casi idéntica a nuestra <code>IntList</code>, excepto que <code>i64</code> ha sido reemplazado por <code>T</code>. Ese <code>T</code> puede parecer especial, pero es solo un nombre de variable. Podríamos haberlo llamado <code>item_type</code>. Sin embargo, siguiendo la convención de nombres de Zig, las variables de tipo <code>type</code> son PascalCase.</p>
<hr/>
<br/>
<p>Para bien o para mal, usar una sola letra para representar un parámetro de tipo es mucho más antiguo que Zig. T es un valor predeterminado común en la mayoría de los lenguajes, pero verás variaciones específicas del contexto, como los mapas hash que usan K y V para sus tipos de parámetros de clave y valor.</p>
<hr/>
<br/>
<p>Si no estás seguro acerca de nuestro esqueleto, considera los dos lugares donde usamos <code>T</code>: <code>items: []T</code> y <code>allocator.alloc(T, 4)</code>. Cuando queramos usar este tipo genérico, crearemos una instancia usando:</p>
<pre class="language-zig"><code class="language-zig"><span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token function">List</span><span class="token punctuation">(</span><span class="token builtin-type keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>allocator<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<br/>
<p>Cuando el código se compila, el compilador crea un nuevo tipo reemplazando cada <code>T</code> por <code>u32</code>. Si volvemos a usar <code>List(u32)</code>, el compilador reutilizará el tipo que creó anteriormente. Si especificamos un nuevo valor para <code>T</code>, digamos <code>List(bool)</code> o <code>List(User)</code>, se crearán nuevos tipos.</p>
<p>Para completar nuestra <code>List</code> genérica, podemos copiar y pegar literalmente el resto del código de <code>IntList</code> y reemplazar <code>i64</code> con <code>T</code>. Aquí tienes un ejemplo completo y funcional:</p>
<pre class="language-zig"><code class="language-zig"><span class="token keyword">const</span> std <span class="token operator">=</span> <span class="token builtin">@import</span><span class="token punctuation">(</span><span class="token string">"std"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Allocator <span class="token operator">=</span> std<span class="token punctuation">.</span>mem<span class="token punctuation">.</span>Allocator<span class="token punctuation">;</span>

<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token class-name"><span class="token operator">!</span><span class="token builtin-type keyword">void</span></span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> gpa <span class="token operator">=</span> std<span class="token punctuation">.</span>heap<span class="token punctuation">.</span><span class="token function">GeneralPurposeAllocator</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> allocator <span class="token operator">=</span> gpa<span class="token punctuation">.</span><span class="token function">allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token function">List</span><span class="token punctuation">(</span><span class="token builtin-type keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>allocator<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">defer</span> list<span class="token punctuation">.</span><span class="token function">deinit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">..</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">|</span>i<span class="token operator">|</span> <span class="token punctuation">{</span>
		<span class="token keyword">try</span> list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token builtin">@intCast</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	std<span class="token punctuation">.</span>debug<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>"<span class="token punctuation">{</span>any<span class="token punctuation">}</span>
"<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">{</span>list<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">..</span>list<span class="token punctuation">.</span>pos<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function">List</span><span class="token punctuation">(</span><span class="token keyword">comptime</span> T<span class="token punctuation">:</span> <span class="token class-name"><span class="token builtin-type keyword">type</span></span><span class="token punctuation">)</span> <span class="token class-name"><span class="token builtin-type keyword">type</span></span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
		pos<span class="token punctuation">:</span> <span class="token class-name"><span class="token builtin-type keyword">usize</span></span><span class="token punctuation">,</span>
		items<span class="token punctuation">:</span> <span class="token class-name"><span class="token punctuation">[</span><span class="token punctuation">]</span>T</span><span class="token punctuation">,</span>
		allocator<span class="token punctuation">:</span> <span class="token class-name">Allocator</span><span class="token punctuation">,</span>

		<span class="token keyword">fn</span> <span class="token function">init</span><span class="token punctuation">(</span>allocator<span class="token punctuation">:</span> <span class="token class-name">Allocator</span><span class="token punctuation">)</span> <span class="token operator">!</span><span class="token function">List</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token punctuation">{</span>
				<span class="token punctuation">.</span>pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
				<span class="token punctuation">.</span>allocator <span class="token operator">=</span> allocator<span class="token punctuation">,</span>
				<span class="token punctuation">.</span>items <span class="token operator">=</span> <span class="token keyword">try</span> allocator<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span>T<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">fn</span> <span class="token function">deinit</span><span class="token punctuation">(</span>self<span class="token punctuation">:</span> <span class="token function">List</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token class-name"><span class="token builtin-type keyword">void</span></span> <span class="token punctuation">{</span>
			self<span class="token punctuation">.</span>allocator<span class="token punctuation">.</span><span class="token function">free</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>items<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">fn</span> <span class="token function">add</span><span class="token punctuation">(</span>self<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token function">List</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token class-name"><span class="token operator">!</span><span class="token builtin-type keyword">void</span></span> <span class="token punctuation">{</span>
			<span class="token keyword">const</span> pos <span class="token operator">=</span> self<span class="token punctuation">.</span>pos<span class="token punctuation">;</span>
			<span class="token keyword">const</span> len <span class="token operator">=</span> self<span class="token punctuation">.</span>items<span class="token punctuation">.</span>len<span class="token punctuation">;</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>pos <span class="token operator">==</span> len<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token comment">// nos hemos quedado sin espacio</span>
                <span class="token comment">// crear un nuevo slice que sea el doble de grande</span>
				<span class="token keyword">var</span> larger <span class="token operator">=</span> <span class="token keyword">try</span> self<span class="token punctuation">.</span>allocator<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span>T<span class="token punctuation">,</span> len <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// copia los elementos que agregamos anteriormente a nuestro nuevo espacio</span>
				<span class="token builtin">@memcpy</span><span class="token punctuation">(</span>larger<span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">..</span>len<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>items<span class="token punctuation">)</span><span class="token punctuation">;</span>

				self<span class="token punctuation">.</span>allocator<span class="token punctuation">.</span><span class="token function">free</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>items<span class="token punctuation">)</span><span class="token punctuation">;</span>

				self<span class="token punctuation">.</span>items <span class="token operator">=</span> larger<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			self<span class="token punctuation">.</span>items<span class="token punctuation">[</span>pos<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
			self<span class="token punctuation">.</span>pos <span class="token operator">=</span> pos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<br/>
<p>Nuestra función <code>init</code> devuelve un <code>List(T)</code>, y nuestras funciones <code>deinit</code> y <code>add</code> toman un <code>List(T)</code> y <code>*List(T)</code>. En nuestra clase simple, eso está bien, pero para estructuras de datos grandes, escribir el nombre genérico completo puede volverse un poco tedioso, especialmente si tenemos múltiples parámetros de tipo (por ejemplo, un mapa hash que toma un <code>type</code> separado para su clave y valor). La función integrada <code>@This()</code> devuelve el <code>type</code> más interno desde donde se llama. Lo más probable es que nuestro <code>List(T)</code> se escribiría como:</p>
<pre class="language-zig"><code class="language-zig"><span class="token keyword">fn</span> <span class="token function">List</span><span class="token punctuation">(</span><span class="token keyword">comptime</span> T<span class="token punctuation">:</span> <span class="token class-name"><span class="token builtin-type keyword">type</span></span><span class="token punctuation">)</span> <span class="token class-name"><span class="token builtin-type keyword">type</span></span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
		pos<span class="token punctuation">:</span> <span class="token class-name"><span class="token builtin-type keyword">usize</span></span><span class="token punctuation">,</span>
		items<span class="token punctuation">:</span> <span class="token class-name"><span class="token punctuation">[</span><span class="token punctuation">]</span>T</span><span class="token punctuation">,</span>
		allocator<span class="token punctuation">:</span> <span class="token class-name">Allocator</span><span class="token punctuation">,</span>

		<span class="token comment">// Added</span>
		<span class="token keyword">const</span> Self <span class="token operator">=</span> <span class="token builtin">@This</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">fn</span> <span class="token function">init</span><span class="token punctuation">(</span>allocator<span class="token punctuation">:</span> <span class="token class-name">Allocator</span><span class="token punctuation">)</span> <span class="token class-name"><span class="token operator">!</span>Self</span> <span class="token punctuation">{</span>
			<span class="token comment">// ... same code</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">fn</span> <span class="token function">deinit</span><span class="token punctuation">(</span>self<span class="token punctuation">:</span> <span class="token class-name">Self</span><span class="token punctuation">)</span> <span class="token class-name"><span class="token builtin-type keyword">void</span></span> <span class="token punctuation">{</span>
			<span class="token comment">// .. same code</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">fn</span> <span class="token function">add</span><span class="token punctuation">(</span>self<span class="token punctuation">:</span> <span class="token class-name"><span class="token operator">*</span>Self</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token class-name"><span class="token operator">!</span><span class="token builtin-type keyword">void</span></span> <span class="token punctuation">{</span>
			<span class="token comment">// .. same code</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<br/>
<p><code>Self</code> no es un nombre especial, es solo una variable, y está en PascalCase porque su valor es un <code>type</code>. Podemos usar <code>Self</code> donde anteriormente usábamos <code>List(T)</code>.</p>
<hr/>
<br/>
<p>Podríamos crear ejemplos más complejos, con múltiples parámetros de tipo y algoritmos más avanzados. Pero, al final, el código genérico básico no sería diferente de los ejemplos simples anteriores. En la próxima parte volveremos a tratar los genéricos cuando veamos <code>ArrayList(T)</code> y <code>StringHashMap(V)</code> de la biblioteca estándar.</p>  </div> </article> </main> <footer class="pt-8 px-1 pb-24 bg-[#242526] text-white text-center">
&copy; 2024 Zig.lat. All rights reserved.
<div class="flex justify-center gap-1 mt-2"> <a class="no-underline text-gray-400 hover:text-gray-200" href="https://github.com/ziglatino/zig-lat" target="_blank"> <img src="/github.svg" class="w-10" alt="github"> </a> </div> </footer> </body></html>